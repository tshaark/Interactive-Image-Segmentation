#:import cv cv2
<Root>:
    id : rootobj
    FloatLayout:
        orientation: 'vertical'
        FloatLayout:
            ActionBar:
                pos_hint: {'top':1}
                ActionView:
                    use_separator: True
                    ActionPrevious:
                        title: 'Interactive Image Segmentation'
                        with_previous: False
                        app_icon_width: 1
                        app_icon_height: 1
                    ActionOverflow:
                    ActionButton:
                        text: 'Load'
                        on_release: root.show_load()
                    ActionButton:
                        text: 'Save'
                        on_release: root.show_save() 
                    ActionButton:
                        text: 'Instructions'
                        on_release: root.show_watershed_inst()     
                    ActionButton:
                        text: 'Exit'
                        on_release: root.quit()
        
        BoxLayout:
            size_hint: [.85, .95]
            pos_hint: { 'top' : 0.98, 'x':0 }

            # Add padding and spacing
            orientation: 'vertical'
            padding: 50
            spacing: 100
            id : cv
            Widget:
                id: w_canvas
                size: self.size
                canvas:
                    Color:
                        group: 'a'
                        rgb: [.8, .8, .8]
                    Rectangle:
                        group: 'b'
                        pos: self.pos
                        size: self.size
                        source: ""

        
            
        
        FloatLayout:
            orientation: "vertical"
            FloatLayout:
            ActionBar:
                pos_hint: {'bottom':1}
                ActionView:
                    use_separator: True
                    ActionPrevious:
                        title: "Menu"
                        with_previous: False
                        app_icon_width: 1
                        app_icon_height: 1
                    ActionOverflow:
                    ActionGroup:
                        text: 'Mode'
                        ActionButton:
                            text: 'Watershed'
                            on_press: root.use_watershed()
                        ActionButton:
                            text: 'Grabcut'
                            on_press: root.use_grabcut()
                    ActionButton:
                        text: 'Reset'
                        on_release: root.reset()
                    


                
        

<LoadDialog>:
    BoxLayout:
        size: root.size
        pos: root.pos
        orientation: "vertical"
        FileChooserIconView:
            id: filechooser

        BoxLayout:
            size_hint_y: None
            height: 30
            Button:
                text: "Cancel"
                on_release: root.cancel()

            Button:
                text: "Load"
                on_release: root.load(filechooser.path, filechooser.selection)

<SaveDialog>:
    text_input: text_input
    BoxLayout:
        size: root.size
        pos: root.pos
        orientation: "vertical"
        FileChooserIconView:
            id: filechooser
            on_selection: text_input.text = self.selection and self.selection[0] or ''

        TextInput:
            id: text_input
            size_hint_y: None
            height: 30
            multiline: False

    BoxLayout:
        size_hint_y: None
        height: 30
        Button:
            text: "Cancel"
            on_release: root.cancel()

        Button:
            text: "Save"
            on_release: cv.imwrite(filechooser.path + '/' + text_input.text, root.update_image)

<PopupWatershed>:
    FloatLayout:
        size: root.size
        pos: root.pos
        orientation: "vertical"
        FloatLayout:
            height: 30
            Label:
                text: "[u][b]WATERSHED:[/b][/u]\n\n1.) numkey(1-7) -> switch marker color\n2.) SPACE -> update segmentation \n3.) r -> reset \n4.) a -> toggle autoupdate \n5.) s -> save \n6.) ESC -> exit"
                markup: True
                size_hint: 0.6,0.2
                pos_hint: {'top': 1}
            Label:
                text: "[u][b]GRABCUT:[/b][/u]\n\n1.)At first, in input window, draw a rectangle around the object using the middle mouse button.\n Then press 'n' to segment the object (once or a few times)\n2.)For any finer touch-ups, you can press any of the keys below and draw lines on the areas you want.\n Then again press 'n' to update the output.\n3.)Key '0' - To select areas of sure background\n4.)Key '1' - To select areas of sure foreground\n5.)Key '2' - To select areas of probable background\n6.)Key '3' - To select areas of probable foreground\n7.)Key 'n' - To update the segmentation\n8.)Key 'r' - To reset the setup\n9.)Key 's' - To save the results"
                markup: True
                size_hint: 0.6,0.2
                pos_hint: {'x':0.29,'top': 0.5}
            # BoxLayout:
            #     size_hint_y: None
            #     height: 30
            #     Button:
            #         text: "Cancel"
            #         on_release: root.cancel()